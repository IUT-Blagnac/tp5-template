= Design Patterns - TP5
J.-M. Bruel <jbruel@gmail.com>
v20.1 {localdate}
:tdnum: TP5
:uk!:
:imagesdir: images
//------------------------- variables de configuration
// only used when master document
:icons: font
:experimental:
:numbered!:
:status:
:source-highlighter: rouge
:baseURL: :baseURL: http://bit.ly/innopolis-patterns
:github: https://github.com[GitHub]
// Specific to GitHub
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

endif::[]
//------------------------------------ 
ifdef::uk[]
:lang: uk
:lastName: LAST NAME
:firstName: First Name
:group: Group
:example: Example
:Enseignants: Teachers
:principe: Good design principle
:assignment: Assignment info
:requirements: Requirements
:initial: Initial tasks
:allerPlusLoin: Still hungry?...
:about: About...
:contrib: Contributors
endif::[]
ifndef::uk[]
:lang: fr
:lastName: NOM
:firstName: Prénom
:group: Groupe
:example: Exemple
:Enseignants: Enseignants
:principe: Principe Objet
:assignment: Informations générales
:requirements: Pré-requis
:initial: Tâche initiale
:allerPlusLoin: Pour Aller plus loin...
:about: À propos...
:contrib: Contributeurs
endif::[]
:java: https://www.java.com/fr/[Java]
:asciidoc: http://www.methods.co.nz/asciidoc[AsciiDoc]indexterm:[AsciiDoc]
:asciidoctorlink: http://asciidoctor.org/[Asciidoctor]indexterm:[Asciidoctor]
//------------------------------------ 
:cpte: Compte
:ag: AgenceBancaire
:app: ApplicationAgenceBancaire


ifndef::backend-pdf[]
//------------------------------------ Badges --------
image:https://img.shields.io/github/workflow/status/IUT-Blagnac/tp5-template/GitHub%20Classroom%20Workflow?&logo=github-actions&logoColor=white&label=auto+grading["CI status", link="https://github.com/IUT-Blagnac/tp5-template"]
image:https://img.shields.io/badge/License-MIT-yellow.svg[License: MIT, linkl="https://opensource.org/licenses/MIT"]
//------------------------------------ Badges --------
endif::[]

https://github.com/IUT-Blagnac/cpoa-tp4-template

ifdef::uk[]
== {tdnum} initial code 


This is a template for the students' assignments.

ifndef::backend-pdf[]
TIP: Course material: pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] http://bit.ly/jmb-cpoa
endif::[]

ifdef::backend-pdf[]
TIP: Course material: icon:mobile[] icon:tablet[] icon:laptop[] http://bit.ly/jmb-cpoa
endif::[]
endif::[]

ifndef::uk[]
== Code initial pour le {tdnum}

ifndef::backend-pdf[]
TIP: Rappel du cours : pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] http://bit.ly/jmb-cpoa
endif::[]

ifdef::backend-pdf[]
TIP: Rappel du cours : icon:mobile[] icon:tablet[] icon:laptop[] http://bit.ly/jmb-cpoa
endif::[]

endif::[]

//------------------------------------ 
== {assignment}

{lastName}:: BRUEL

{firstName}:: Jean-Michel

{group} #::

[%interactive]
- [X] {Enseignants}
- [ ] 1
- [ ] 2
- [ ] 3
- [ ] 4
- [ ] Innopolis

//------------------------------------ 
== {requirements}

ifdef::uk[]
You'll need:

[%interactive]
* [x] A {Github} account  
* [ ] A https://gitforwindows.org/[Git Bash] terminal (if you use Window$)
endif::[]
ifndef::uk[]
Il vous faut :

[%interactive]
* [x] Un compte {Github}  
* [ ] Un terminal de type https://gitforwindows.org/[Git Bash]  (si vous utilisez Window$)
endif::[]

ifdef::uk[]
[TIP]
====    
Try the following command in your terminal to check your `git` environment:
endif::[]
ifndef::uk[]
[TIP]
====    
Essayez la commande suivante dans votre terminal pour vérifier votre environnement `git` :
endif::[]

[source,shell]
....
git config --global -l
....
====

//------------------------------------ 
== {initial}

ifdef::uk[]
[%interactive]
* [x] Click on the Github Classroom link provided by your teacher (in fact, this should be done if you read this).
* [ ] Clone on your machine the Github project generated by Github Classroom.  
* [ ] Modify the README file to add your last name, first name and group number. 
* [ ] Commit and push using the following message:
endif::[]
ifndef::uk[]
[%interactive]
* [x] Clickez sur le lien Github Classroom fourni par votre enseignant (en fait c'est déjà fait si vous lisez ces lignes).
* [ ] Clonez sur votre machine le projet Github généré pour vous par Github Classroom.  
* [ ] Modifez le `README` pour modifier Nom, Prénom et Groupe. 
* [ ] Commit & push:
endif::[]

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #0 Initial task done
....

[IMPORTANT]
ifndef::uk[]
Dans la suite de ce document, à chaque fois que vous trouverez un énoncé commençant par `fix #...` vous devez vérifier que vos scripts/fichiers modifiés sont bien dans votre dépôt local en vue de committer et de pusher les modifications sur votre dépôt distant en utilisant comme message de commit cet énoncé.

[TIP]
====
- Si vous voulez vérifier que vous êtes prêt pour le `fix #0`, utilisez la commande : `make check`.
- Si vous voulez avoir la liste des ToDos de ce TP/TP, exécutez `make todos`.
====

endif::[]

ifdef::uk[]
In the following, every time you'll see à `fix #...` text, 
make sure all your files are committed, and then push your modifications in the distant repo, making sure you used the corresponding message (`fix #...`) in one of the `commit` messages.

[TIP]
====
- If you want to check that you're really ready for `fix #0`, you can run the command in your shell: `make check`.
- If you want to list the ToDos of the day, run `make todos`.
====

endif::[]

//------------------------------------ 
//------------------------------------ 
//------------  Let's START----------- 
//------------------------------------ 
//------------------------------------ 

:numbered:

Récupérer l'archive de projet Eclipse link:ObserverInitialCode.zip[ObserverInitialCode.zip]. 
L'importer dans un workspace Eclipse.

.	Lire rapidement les et comparer les applications `observer.nonpattern` et `observer.pattern`.
.	Lancer les 2 applications (`CourseViewer.main() et `CourseController.main()`) et observer ce quelles affichent.

== Exercices

=== Reverse Engineering

.	Obtenez et comparez les 2 diagrammes de classes des deux packages (`TP5.plantuml` et `TP5-observer.plantuml` à placer dans le répertoire `docs`).

Vous devez obtenir les 2 diagrammes suivants :

.`observer.nonpattern`
image::TP5.svg[TP5]

.`observer.pattern`
image::TP5-observer.svg[TP5]


.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.1: Add Class Diagrams
....

=== Evolution du code `observer.nonpattern`

Etendre le code `observer.nonpattern` pour présenter le vecteur de `CourseRecords` comme un camembert (_pie chart_), en plus de la forme actuelle (_bar chart_). 

TIP: Allez à l'essentiel, le but n'est pas d'avoir un super code, mais de vous confronter à la difficulté d'évolution.
Pour plus de détails sur les camembers en Swing, cf. <<sf,section finale>>.

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.2: Add Pie Chart in nonPattern
....

=== Evolution du code `observer.pattern`

Faites la même chose avec le code `observer.pattern` 

Que pensez-vous de la différence (en terme d'effort de codage et de résultat)?

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.3: Add Pie Chart in Pattern
....

=== Push vs. Pull

Vous avez pu observer que la version du patron _Observer_ utilisait un modèle _pull_ (`notifyObservers()` n'envoie aucune information).

Réalisez une version `push`.

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.4: Add push version
....

=== Inconvénient du _push_

Dans cette nouvelle version, si les programmes ont plus de 1000 cours, et si l'un seulement évolue, `notifyObservers()` 
pousse toutes les informations sur tous les observateurs! 

Améliorez votre modèle _push_ pour qu'il ne pousse que les données pertinentes. 

TIP: Pour cet exercice, vous pourrez ignorer les changement de `New Course` et continuer à utiliser le modèle _pull_ pour ce type de changement. 

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.5: Change notify for smart push
....

=== Sélection des _updates_

Vous aurez remarqué que `CourseController` n'est intéressé que par les changements de `New Course`, alors que `BarChart` et `PieChart` ont besoin de connaitre les changements de valeurs de `JSlider`. 
Etendre l'interface d'inscription de `Observable` (la méthode `attach`) pour que `CourseController` ne reçoivent plus les mises à jour des `updates` qui ne l'intéressent pas. 

.ToDo
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.6: Add Smart attach()
....

:numbered!:

[[sf]]
== How to draw a pie chart ?


Here is a code segment that draws a pie chart given a Graphics object and 
an Array containing Integers to be represented in the pie chart. 
It is drawn at location (xOffset, yOffset) and with the radius specified to be of size 100.

[source,java]
-----
public void paint(Graphics g, Integer[] data) {
	super.paint(g);
	int radius = 100;
	
	//first compute the total number of students
	double total = 0.0;
	for (int i = 0; i < data.length; i++) {
		total += data[i];
	}
	//if total == 0 nothing to draw
	if (total != 0) {
		double startAngle = 0.0;
		for (int i = 0; i < data.length; i++) {
			double ratio = (data[i] / total) * 360.0;
			//draw the arc
			g.setColor(LayoutConstants.subjectColors[i%LayoutConstants.subjectColors.length]);
			g.fillArc(LayoutConstants.xOffset, LayoutConstants.yOffset + 300, 2 * radius, 2 * radius, (int) startAngle, (int) ratio);
			startAngle += ratio;
		}
	}
}
-----
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #All: Completed all duties
....


ifndef::compact[]
//------------------------------------ 
== {contrib}
//------------------------------------ 

- mailto:jbruel@gmail.com[Jean-Michel Bruel]

== {about}

****************************************************************
Baked with {asciidoctorlink} (version `{asciidoctor-version}`) from 'Dan Allen', based on {asciidoc}.
'Licence Creative Commons'.
image:88x31.png["Licence Creative
Commons",style="border-width:0",link="http://creativecommons.org/licenses/by-sa/3.0/"]
http://creativecommons.org/licenses/by-sa/3.0/[licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé].
****************************************************************
endif::[]
